<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kobe Beef 511 アンケート</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background-color: #f5f5dc; }
        .stars { display: flex; justify-content: center; }
        .star { font-size: 30px; cursor: pointer; padding: 5px; }
        .selected { color: gold; }
        .hidden { display: none; }
        textarea { width: 80%; height: 100px; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>神戸牛511での体験はいかがでしたか？<br>How was your experience at Kobe Beef 511?</h2>
    
    <p>料理はいかがでしたか？<br>Did you enjoy the food?</p>
    <div class="stars" data-question="food">
        <span class="star" data-value="1">★</span>
        <span class="star" data-value="2">★</span>
        <span class="star" data-value="3">★</span>
        <span class="star" data-value="4">★</span>
        <span class="star" data-value="5">★</span>
    </div>
    
    <p>サービスはいかがでしたか？<br>How was our service?</p>
    <div class="stars" data-question="service">
        <span class="star" data-value="1">★</span>
        <span class="star" data-value="2">★</span>
        <span class="star" data-value="3">★</span>
        <span class="star" data-value="4">★</span>
        <span class="star" data-value="5">★</span>
    </div>
    
    <p>当店をどのように見つけましたか？<br>How did you find our restaurant?</p>
    <div class="stars" data-question="discovery">
        <span class="star" data-value="1">★</span>
        <span class="star" data-value="2">★</span>
        <span class="star" data-value="3">★</span>
        <span class="star" data-value="4">★</span>
        <span class="star" data-value="5">★</span>
    </div>

    <p>ご意見をお聞かせください:<br>Leave your feedback:</p>
    <textarea id="feedback" placeholder="Your feedback here..."></textarea><br>
    
    <button onclick="submitSurvey()">送信 / Submit</button>
    
    <div id="result" class="hidden"></div>
    
    <script>
        const scriptURL = "https://script.google.com/macros/s/AKfycbzCl2ot02Idi40Fe7KUyMOAMkwMtwAhpIV4plpKattzmmaS4ODDZoY6c0l3SDKR3AeRkA/exec"; // Replace with your deployed script URL

        document.querySelectorAll('.stars').forEach(starGroup => {
            starGroup.addEventListener('click', function(e) {
                if (e.target.classList.contains('star')) {
                    let value = parseInt(e.target.getAttribute('data-value'));
                    let stars = e.target.parentElement.children;
                    for (let star of stars) {
                        star.classList.remove('selected');
                        if (parseInt(star.getAttribute('data-value')) <= value) {
                            star.classList.add('selected');
                        }
                    }
                    e.target.parentElement.setAttribute('data-selected', value);
                }
            });
        });

        function submitSurvey() {
            let ratings = document.querySelectorAll('.stars');
            let data = { feedback: document.getElementById('feedback').value };
            let allAboveThree = true;

            ratings.forEach(rating => {
                let question = rating.getAttribute('data-question');
                let value = parseInt(rating.getAttribute('data-selected')) || 0;
                data[question] = value;
                if (value < 3) allAboveThree = false;
            });

            fetch(scriptURL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(response => response.text())
              .then(responseText => {
                  console.log(responseText);
                  let result = document.getElementById('result');
                  if (allAboveThree) {
                      result.innerHTML = '<h3>レビューを投稿しませんか？<br>Would you like to leave a review?</h3><p><a href="https://g.page/r/CQWGnoIOJ_vVEBM/review" target="_blank">レビューを書く / Leave a Review</a></p>';
                  } else {
                      result.innerHTML = '<h3>ご満足いただけず申し訳ございません。<br>We are sorry you did not enjoy your time.</h3><p>ありがとうございます！ご意見をいただきました。</p>';
                  }
                  result.classList.remove('hidden');
              })
              .catch(error => console.error("Error:", error));
        }
    </script>
</body>
</html>
